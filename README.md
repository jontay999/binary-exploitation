# Just my exploration into Binary Exploitation

### Kali Setup / Useful Tools

- Install [pwninit](https://github.com/io12/pwninit)
  - Setup
    - install cargo: `curl https://sh.rustup.rs -sSf | sh`
    - install pwninit: `cargo install pwninit`
    - I faced an error
    ```
    warning: failed unstripping libc: failed running eu-unstrip, please install elfutils: No such file or directory (os error 2)
    ```
  - Usefulness:
    - Helps you download a linker that will help you load a provided `libc` without segfaulting
    - Downloads debug symbols and unstrips the `libc`
    - Follow this up with `patchelf` to use the correct RPATH and interpreter for the provided `libc`
- Install [patchelf](https://github.com/NixOS/patchelf)

  - `sudo apt -y install patchelf`
  - configures the binary to use the `ld` linker file that was downloaded from `pwninit` rather than the system's one
  - e.g. `patchelf --set-interpreter <ld file from pwninit> <binary file to use ld file>`
  - Once this is done, can run `LD_PRELOAD=<libc.so file> ./binary`

- Can run `readelf -a <binary>` to see the headers + segments, or just find out ELF info
- `ldd <binary>` shows you which libc and which linker the binary is configured to use. Can use this to check if the binary is using the system libc or the one in your directory.
- `checksec --file=<binary>` to see protections

  - `RELRO`: determines if Global Offset Table is writable
  - `NX`: determines if stack is executable --> can put shellcode on stack
  - `PIE`: depends if ASLR (Address Space Layout Randomization is enabled) --> different addresses each time
    - Note that in GDB its configured to disable ASLR all the time, see below for command to turn enable it
    - ASLR must maintain the last 3 nibbles (1.5 bytes) the same based on alignment and relative offsets

- Don't forget to create a `flag.txt` file sometimes, otherwise the binary might give a segfault if it `freads` or `fopen` from that file

- Install VSCode

  - sudo apt update
  - sudo apt install curl gpg gnupg2 software-properties-common apt-transport-https
  - curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
  - sudo install -o root -g root -m 644 microsoft.gpg /etc/apt/trusted.gpg.d/
  - echo "deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main" | sudo tee /etc/apt/sources.list.d/vscode.list
  - sudo apt update
  - sudo apt install code

- Edit `PATH` to be able to use the binaries you install

  - check with shell you are using with `ps -p $$`
    - Bash --> edit `~/.bashrc`
    - Zsh --> edit `~/.zshrc`
  - `export PATH="$PATH:/home/kali/.local/bin:/home/kali/.cargo/bin"`

- can use `strace` to view system calls
- `nm -D <binary>` to see what function imports there are
  - shows symbols in binaries

### Useful Links

- Libc Database: [https://libc.blukat.me/](https://libc.blukat.me/)
- CryptoCat Pwn Github: [https://github.com/Crypto-Cat/CTF/tree/main/pwn](https://github.com/Crypto-Cat/CTF/tree/main/pwn)
- ROP Emporium: [https://ropemporium.com/](https://ropemporium.com/)
- Exploit Education: [https://exploit.education/](https://exploit.education/)
- Pwn College: [https://pwn.college/](https://pwn.college/)
- ROP Gadget: [https://github.com/JonathanSalwan/ROPgadget](https://github.com/JonathanSalwan/ROPgadget)
- Syscall Table: [https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/](https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/)

### GDB stuff

- `x/32gx <0xaddress>`
  - `x` == examine
  - `gx` == 8 bytes values in hexadecimal
- `disass main`
  - disassemble the main function
- `info functions`
  - show list of all defined functions
- `info registers`
  - see values held in registers
- `set disable-randomization off`
  - enable ASLR
- `b *(0xaddress)`
  - set breakpoint at the particular address
- `heap`: examine heap (including tcache)
- `p $rdx`: prints value of rdx register
  - `p/x` to print in hexadecimal format
- `bins` to see bins lol

```
pwndbg> bins
tcachebins
0x90 [  2]: 0x603890 —▸ 0x603800 ◂— 0x0
fastbins
0x20: 0x0
0x30: 0x0
0x40: 0x0
0x50: 0x0
0x60: 0x0
0x70: 0x0
0x80: 0x0
unsortedbin
all: 0x0
smallbins
empty
largebins
empty
```

- `fini` to step out of a function call, especially if you're going through a glibc function currently
- press enter to repeat previous command
- `vis_heap_chunks`: visualize heap chunks

### Ghidra stuff

- `l` to rename variable
- If you see stuff like `&DAT_00400b53`, means it is a global variable
  - double click, if its a string, can just `cmd + l` to change variable data type to like `char [3]`

### Random

- returned values are stored in `$rax`
- `LANG` environment variable determines sorting of file from `ls`
- standard is `int main(int argc, char **argv, char **envp)`
- `objdump -d <binary> -M intel`
  - use `-d` for disassemble
  - use `-M` for intel syntax because ATNT assembly is weird on x86
- `du -sb <file>`: shows number of bytes in file
- `kill -l`: lists all the signals
- `pgrep <process>` === `ps aux | grep <process>`
  - used to find the process Id so you can do something like `kill -9 <process>` to kill it
